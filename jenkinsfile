pipeline {
    agent any

    stages {
        stage('Setup') {
            steps {
                sh 'python3 -m venv venv'
                sh '. venv/bin/activate && pip install -r requirements.txt'
            }
        }
        stage('Run Scan') {
            steps {
                // Replace with your scan command, e.g., OWASP ZAP, Bandit, etc.
                sh 'echo "Scanning..."'
                sh 'echo "Sample scan report" > scan_report.json'
            }
        }
        stage('Upload Scan Report to DefectDojo') {
            steps {
                script {
                    def dojoUrl = 'https://your-defectdojo-instance/api/v2/import-scan/'
                    def apiKey = 'your-defectdojo-api-key'
                    def productId = 'your-defectdojo-product-id'
                    
                    sh """
                    curl -X POST ${dojoUrl} \
                        -H "Authorization: Token ${apiKey}" \
                        -F 'scan_type=Generic Findings Import' \
                        -F 'file=@scan_report.json' \
                        -F 'product_id=${productId}'
                    """
                }
            }
        }
    }
}
